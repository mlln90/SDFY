(function(a){a.fn.extend({writediscern:function(n){function w(a){a.targetTouches?(a.preventDefault(),a=a.targetTouches[0],g.push(a.pageX-262.5),m.push(a.pageY-463)):(g.push(a.layerX),m.push(a.layerY));q=1;p.push(0)}function x(a){var b;a.targetTouches?(a.preventDefault(),a=a.targetTouches[0],b=a.pageX-262.5,a=a.pageY-463):(b=a.layerX,a=a.layerY);if(1==q){g.push(b);m.push(a);p.push(1);c.save();c.translate(c.canvas.clientWidth/2,c.canvas.clientHeight/2);c.translate(-c.canvas.clientWidth/2,-c.canvas.clientHeight/
2);c.beginPath();c.lineWidth=2;for(b=1;b<g.length;b++)t=g[b],u=m[b],0==p[b]?c.moveTo(t,u):c.lineTo(t,u);c.strokeStyle="hsl(90, 100%, 0%)";c.shadowColor="#999";c.shadowBlur=1;c.stroke();c.restore()}}function y(a){a.changedTouches?(a.preventDefault(),a=a.changedTouches[0],g.push(a.pageX-262.5),m.push(a.pageY-463)):(g.push(a.layerX),m.push(a.layerY));z()}function z(){if(1==q){q=0;p.push(0);h=h.splice(0,h.length-2);a.each(g,function(a,b){h.push(Math.ceil(g[a]/2));h.push(Math.ceil(m[a]/2))});g=[];m=[];
p=[];h.push(0);h.push(255);h.push(255);h.push(255);var f=JSON.stringify(h);b.config.isZzj?ChineseInput.HandWritingReconize(f,function(f,c){f=JSON.parse(c);c=[];a.each(f,function(a,b){c.push({Key:a,Value:b})});"function"==typeof b.config.writeback&&b.config.writeback(c,r);A(c)}):(f="\u6211\u4f60\u59d3\u540d\u4ed6\u4eec\u738b\u715e\u4f98\u7684\u901f\u5c31\u54e6\u53bb".split(""),"function"==typeof b.config.writeback&&b.config.writeback(f,r),A(f))}}function r(){g=[];m=[];p=[];h=[];c.clearRect(0,0,d.width,
d.height)}function A(b){var c=1,f=a.GetPageNum(b.length,8);a(".write-discern .output-character .btn-page").removeClass("yes");if(1<f){var e=a(".write-discern .output-character .character-prev-page"),d=a(".write-discern .output-character .character-next-page");d.addClass("yes");e.unbind("click");e.on("click",function(){var e=c;c--;1>=c&&(c=1,a(this).removeClass("yes"));c<f&&d.addClass("yes");e!=c&&(a.TheKeySound(),v(c,8,b))});d.unbind("click");d.on("click",function(){var d=c;c++;c>=f&&(c=f,a(this).removeClass("yes"));
1<c&&e.addClass("yes");d!=c&&(a.TheKeySound(),v(c,8,b))})}v(c,8,b)}function v(c,d,e){c=(c-1)*d;d=e.slice(c,c+d);var f=a(".write-discern .character-list ul");f.empty();a.each(d,function(a,c){f.append(b.config.isZzj?"<li>"+c.Value+"</li>":"<li>"+c+"</li>")});f.find("li").one("click",function(){a.TheKeySound();var c=a(b.config.input).val(),d=a(this).text();f.empty();a(".write-discern .output-character .btn-page").removeClass("yes");r();a(b.config.input).val(c+d);void 0!=b.config.bename&&a(b.config.bename).html(c+
d);"function"==typeof b.config.hanziback&&b.config.hanziback(d)})}function e(a){return void 0==b.param[a]?b.config[a]:b.param[a]}var b=this;b.param=n;b.config={isZzj:!0,input:"",standby:!0,standbyName:"\u62fc \u97f3",blankClickHide:!1,standbyClickHide:!0};void 0!=b.param&&(b.config.isZzj=e("isZzj"),b.config.input=e("input"),b.config.bename=e("bename"),b.config.standby=e("standby"),b.config.standbyName=e("standbyName"),b.config.blankClickHide=e("blankClickHide"),b.config.standbyClickHide=e("standbyClickHide"),
b.config.delback=e("delback"),b.config.blankback=e("blankback"),b.config.writeback=e("writeback"),b.config.resetback=e("resetback"),b.config.hanziback=e("hanziback"),b.config.standbyback=e("standbyback"));if(a(".write-discern").length)a(".write-discern").slideDown("fast");else{n=a("<div>").addClass("write-discern");var k=a("<div>").addClass("output-character text-center clearfix");a("<div>").addClass("pull-left character-prev-page btn-page").html("\u4e0a\u4e00\u9875").appendTo(k);var l=a("<div>").addClass("line-block character-list");
a("<ul>").addClass("clearfix").appendTo(l);a(l).appendTo(k);a("<div>").addClass("pull-right character-next-page btn-page").html("\u4e0b\u4e00\u9875").appendTo(k);a(k).appendTo(n);k=a("<div>").addClass("write-area text-center clearfix m-t-l");l=a("<div>").addClass("pull-left col-7");CanvasWrap=a("<div>").addClass("line-block write-wrap").appendTo(l);a(l).appendTo(k);l=a("<div>").addClass("pull-right col-5 btn-wrap");b.config.standby&&a("<div>").addClass("btn btn-standby").html(b.config.standbyName).appendTo(l);
a("<div>").addClass("btn btn-reset").html("\u91cd \u5199").appendTo(l);a("<div>").addClass("btn btn-del").html("\u5220 \u9664").appendTo(l);a(l).appendTo(k);a(k).appendTo(n);a("<div>").addClass("write-blank text-center").html("\u786e \u8ba4").appendTo(n);a(b).append(n)}a(".write-discern .btn-standby").unbind("click");a(".write-discern .btn-standby").on("click",function(){a.TheKeySound();b.config.standbyClickHide&&a(".write-discern").slideUp("fast");"function"==typeof b.config.standbyback&&b.config.standbyback(a(this))});
a(".write-discern .btn-reset").unbind("click");a(".write-discern .btn-reset").on("click",function(){a.TheKeySound();r();"function"==typeof b.config.resetback&&b.config.resetback(a(this))});a(".write-discern .btn-del").unbind("click");a(".write-discern .btn-del").on("click",function(){a.TheKeySound();var c=a(b.config.input).val(),c=c.substring(0,c.length-1);a(b.config.input).val(c);"function"==typeof b.config.delback&&b.config.delback(c,a(this))});a(".write-discern .write-blank").unbind("click");a(".write-discern .write-blank").on("click",
function(){a.TheKeySound();b.config.blankClickHide&&a(".write-discern").slideUp("fast");"function"==typeof b.config.blankback&&b.config.blankback(a(b.config.input).val(),a(this))});n=a(".write-discern .write-wrap")[0].clientWidth;k=a(".write-discern .write-wrap")[0].clientHeight;a(".write-discern .write-wrap").empty();a("<canvas>").appendTo(a(".write-discern .write-wrap"));var d=a(".write-discern .write-wrap canvas")[0];d.width=n;d.height=k;d.addEventListener("mousedown",w,!1);d.addEventListener("touchstart",
w,!1);d.addEventListener("mousemove",x,!1);d.addEventListener("touchmove",x,!1);d.addEventListener("mouseup",y,!1);d.addEventListener("mouseleave",function(){z()},!1);d.addEventListener("touchend",y,!1);var c=d.getContext("2d"),h=[],g=[],m=[],p=[],t=-1,u=-1,q=0}})})(jQuery);