(function(a){a.fn.extend({CompositeKeyboard:function(k){function q(c){a(".composite-keyboard .keyboard-line li").each(function(b){b=a(this).text();1==c?a(this).html(b.toLowerCase()):a(this).html(b.toUpperCase())})}function r(c){var b=1,g=a.GetPageNum(c.length,8);a(".composite-keyboard .output-character .btn-page").removeClass("yes");if(1<g){var l=a(".composite-keyboard .output-character .character-prev-page"),m=a(".composite-keyboard .output-character .character-next-page");m.addClass("yes");l.unbind("click");
l.on("click",function(){var e=b;b--;1>=b&&(b=1,a(this).removeClass("yes"));b<g&&m.addClass("yes");e!=b&&(a.TheKeySound(),d(b,8,c))});m.unbind("click");m.on("click",function(){var e=b;b++;b>=g&&(b=g,a(this).removeClass("yes"));1<b&&l.addClass("yes");e!=b&&(a.TheKeySound(),d(b,8,c))})}d(b,8,c)}function d(c,e,u){c=(c-1)*e;e=u.slice(c,c+e);var g=a(".composite-keyboard .character-list > ul");g.empty();a.each(e,function(a,c){g.append(b.config.isZzj?"<li>"+c.Value+"</li>":"<li>"+c+"</li>")});g.find("li").one("click",
function(){a.TheKeySound();var c=a(this).text(),e=a(b.config.input).val();a(b.config.input).val(e+c);b.config.letter="";a(".composite-keyboard .output-character .btn-page").removeClass("yes");a(".composite-keyboard .character-letter").empty();g.empty();"function"==typeof b.config.hanziback&&b.config.hanziback(c)})}function c(a){return void 0==b.param[a]?b.config[a]:b.param[a]}var b=this;b.param=k;b.config={isZzj:!0,shift:!1,input:"",letter:"",standby:!1,charlist:".character-list > ul",letterCss:{},
standbyName:"\u5907\u7528",isCapitalBig:!1,blankClickHide:!1,standbyClickHide:!0,keyBoardList:["qwertyuiop".split(""),"asdfghjkl".split(""),"zxcvbnm".split("")]};String.prototype.firstUpperCase=function(){return this.replace(/^\S/,function(a){return a.toUpperCase()})};void 0!=b.param&&(b.config.isZzj=c("isZzj"),b.config.input=c("input"),b.config.shift=c("shift"),b.config.standby=c("standby"),b.config.standbyName=c("standbyName"),b.config.isCapitalBig=c("isCapitalBig"),b.config.blankClickHide=c("blankClickHide"),
b.config.standbyClickHide=c("standbyClickHide"),b.config.delback=c("delback"),b.config.charback=c("charback"),b.config.blankback=c("blankback"),b.config.shiftback=c("shiftback"),b.config.letterCss=c("letterCss"),b.config.hanziback=c("hanziback"),b.config.standbyback=c("standbyback"));if(a(".composite-keyboard").length)a(".composite-keyboard").slideDown("fast");else{var n=a("<div>").addClass("composite-keyboard");a("<div>").addClass("character-letter transparency-bg-color theme-color").css(b.config.letterCss).appendTo(n);
var p=a("<div>").addClass("output-character text-center clearfix");a("<div>").addClass("pull-left character-prev-page btn-page").html("\u4e0a\u4e00\u9875").appendTo(p);a("<div>").addClass("line-block character-list").html('<ul class="clearfix"></ul>').appendTo(p);a("<div>").addClass("pull-right character-next-page btn-page").html("\u4e0b\u4e00\u9875").appendTo(p);a(p).appendTo(n);a.each(b.config.keyBoardList,function(c,e){c=a("<div>").addClass("keyboard-line");var g=a("<div>").addClass("line-block"),
d=a("<ul>").addClass("clearfix");7==e.length&&(k.standby?a("<li>").attr("standby","").html(b.config.standbyName).appendTo(d):a("<li>").attr("shift","").html("\u5927\u5c0f\u5199").appendTo(d));a.each(e,function(c,b){a("<li>").html(b).appendTo(d)});7==e.length&&a("<li>").attr("remove","").html("\u5220\u9664").appendTo(d);a(d).appendTo(g);a(g).appendTo(c);a(c).appendTo(n)});a("<div>").addClass("keyboard-blank text-center").html("\u786e \u8ba4").appendTo(n);a(b).append(n)}b.config.shift?(a(".composite-keyboard .keyboard-line li[shift]").addClass("active"),
a(".composite-keyboard .character-letter").hide(),q()):a(".composite-keyboard .character-letter").show();a(".composite-keyboard .keyboard-line li[shift]").unbind("click");a(".composite-keyboard .keyboard-line li[shift]").on("click",function(){b.config.isCapitalBig||(a.TheKeySound(),a(this).toggleClass("active"),a(this).hasClass("active")?(b.config.shift=!0,q(),b.config.letter="",a(".composite-keyboard .character-letter").hide(),a(".composite-keyboard .character-letter").empty()):(a(".composite-keyboard .character-letter").show(),
b.config.shift=!1,q(1)),"function"==typeof b.config.shiftback&&b.config.shiftback(b.config.shift))});a(".composite-keyboard .keyboard-line li[standby]").unbind("click");a(".composite-keyboard .keyboard-line li[standby]").on("click",function(){a.TheKeySound();b.config.standbyClickHide&&a(".composite-keyboard").slideUp("fast");"function"==typeof b.config.standbyback&&b.config.standbyback(a(this))});a(".composite-keyboard .keyboard-line li[remove]").unbind("click");a(".composite-keyboard .keyboard-line li[remove]").on("click",
function(){a.TheKeySound();var c="";if(b.config.shift)c=a(b.config.input).val(),c=c.substring(0,c.length-1),a(b.config.input).val(c);else{var e=b.config.letter.firstUpperCase(),d=e.substring(0,e.length-1);b.config.letter=d;a(".composite-keyboard .character-letter").html(d);0>=e.length&&(c=a(b.config.input).val(),c=c.substring(0,c.length-1),a(b.config.input).val(c));e=[];b.config.isZzj?e=JSON.parse(ChineseInput.PinyinTrance(c)):(d=PinYin[c],void 0!=d&&(e=d.split("")));r(e)}"function"==typeof b.config.delback&&
b.config.delback(c)});a(".composite-keyboard .keyboard-line li:not(li[shift],li[standby],li[remove])").unbind("click");a(".composite-keyboard .keyboard-line li:not(li[shift],li[standby],li[remove])").on("click",function(){a.TheKeySound();var c=a(this).text();if(b.config.shift){var e=a(b.config.input).val();a(b.config.input).val(e+c)}else{b.config.letter+=c;var d=b.config.letter.firstUpperCase();a(".composite-keyboard .character-letter").html(d);e=[];b.config.isZzj?e=JSON.parse(ChineseInput.PinyinTrance(d)):
(d=PinYin[d],void 0!=d&&(e=d.split("")));r(e)}"function"==typeof b.config.charback&&b.config.charback(c)});a(".composite-keyboard .keyboard-blank").unbind("click");a(".composite-keyboard .keyboard-blank").on("click",function(){a.TheKeySound();b.config.blankClickHide&&a(".composite-keyboard").slideUp("fast");"function"==typeof b.config.blankback&&b.config.blankback(a(b.config.input).val(),a(this))})},spellKeyboard:function(k){function q(c,b){var f=1,h=a.GetPageNum(b.length,10);a(c+" .btn-box .btn").removeClass("yes");
if(1<h){var d=a(c+" .btn-box .btn-prev"),e=a(c+" .btn-box .btn-next");e.addClass("yes");d.unbind("click");d.on("click",function(){var d=f;f--;1>=f&&(f=1,a(this).removeClass("yes"));f<h&&e.addClass("yes");d!=f&&(a.TheKeySound(),r(c,f,10,b))});e.unbind("click");e.on("click",function(){var e=f;f++;f>=h&&(f=h,a(this).removeClass("yes"));1<f&&d.addClass("yes");e!=f&&(a.TheKeySound(),r(c,f,10,b))})}r(c,f,10,b)}function r(b,h,d,e){h=(h-1)*d;d=e.slice(h,h+d);var f=b+" .shade > ul";a(f).empty();a.each(d,function(b,
d){b=c.config.isZzj?"<li>"+d.Value+"</li>":"<li>"+d+"</li>";a(f).append(b)});0<e.length&&a(b+" .shade").show();a(f+" li").one("click",function(){a.TheKeySound();var f=a(c).val(),d=a(this).text();t.empty();a(b+" .shade").hide();a(c).val(f+d);void 0!=c.config.bename&&a(c.config.bename).html(f+d);"function"==typeof c.config.hanziback&&c.config.hanziback(d)})}function d(a){return void 0==c.param[a]?c.config[a]:c.param[a]}var c=this;c.param=k;c.config={top:500,left:207,type:0,isZzj:!0,zindex:99,charlist:["QWERTYUIOP123".split(""),
"ASDFGHJKL456".split(""),"ZXCVBNM0789".split("")]};void 0!=c.param&&(c.config.top=d("top"),c.config.left=d("left"),c.config.type=d("type"),c.config.isZzj=d("isZzj"),c.config.zindex=d("zindex"),c.config.bename=d("bename"),c.config.delback=d("delback"),c.config.charback=d("charback"),c.config.callback=d("callback"),c.config.hanziback=d("hanziback"),c.config.closeback=d("closeback"),c.config.numberback=d("numberback"));a(".spell-container").remove();k=a("<div>").addClass("spell-container").css({top:c.config.top,
left:c.config.left,zIndex:c.config.zindex});var b=a("<div>").addClass("move-box");a("<div>").addClass("letter-box pull-left").appendTo(b);a("<spna>").html("\u62d6\u52a8\u6b64\u5904\u53ef\u79fb\u52a8").appendTo(b);a("<span>").addClass("close").html("\u5173\u95ed").appendTo(b);a(b).appendTo(k);b=a("<div>").addClass("keyboard-box");var n=a("<div>").addClass("char-box"),p=a("<div>").addClass("shade clearfix");a("<ul>").addClass("clearfix pull-left").appendTo(p);var g=a("<div>").addClass("btn-box pull-right");
a("<div>").addClass("btn btn-prev yes").html('<i class="fa fa-caret-left"></i>').appendTo(g);a("<div>").addClass("btn btn-next").html('<i class="fa fa-caret-right"></i>').appendTo(g);a(g).appendTo(p);a(p).appendTo(n);a(n).appendTo(b);var e=a("<div>").addClass("keys-box"),u=c.config.charlist.length-1;a.each(c.config.charlist,function(c,b){var f=a("<div>").addClass("keys-line"),d=a("<ul>").addClass("clearfix");c==u&&a("<li>").html('<i class="fa fa-times"></i>').attr("remove","").appendTo(d);a.each(b,
function(c,b){1==b?a("<li>").html(b).attr("one","").appendTo(d):4==b?a("<li>").html(b).attr("two","").appendTo(d):0==b?a("<li>").html(b).attr("three","").appendTo(d):a("<li>").html(b).appendTo(d)});a(d).appendTo(f);a(f).appendTo(e)});a(e).appendTo(b);a(b).appendTo(k);a("body > .container").append(k);1==c.config.type&&a(".spell-container .char-box").hide();a(".spell-container .move-box .close").on("click",function(b){a(".spell-container").slideUp("fast",function(){a(this).remove()});"function"==typeof c.config.closeback&&
c.config.closeback()});var l,m=!1;a(".spell-container .move-box").on("mousedown touchstart",function(b){c.config.top=a(".spell-container").position().top;c.config.left=a(".spell-container").position().left;b.targetTouches?(b.preventDefault(),b=b.targetTouches[0],l=b.pageY,xs=b.pageX):(l=b.clientY,xs=b.clientX);m=!0});a("body").on("mousemove touchmove",function(b){if(m){if(b.targetTouches){b.preventDefault();b=b.targetTouches[0];var d=b.pageX-xs;b=b.pageY-l}else d=b.clientX-xs,b=b.clientY-l;a(".spell-container").css({top:b+
c.config.top,left:d+c.config.left})}});a("body").on("mouseup touchend",function(a){m=!1});var t=a(".spell-container .letter-box");a(".spell-container .keys-box li:not(li[remove])").on("click",function(){a.TheKeySound();var b=a(this).text();if(1==c.config.type){var d=a(c).val();a(c).val(d+b);void 0!=c.config.bename&&a(c.config.bename).html(d+b);"function"==typeof c.config.callback&&c.config.callback(b)}else if(d=t.text(),0<=b){var e=a(".spell-container .shade > ul li:eq("+b+")");d=a(c).val();e=e.text();
t.empty();a(".spell-container .shade").hide();a(c).val(d+e);void 0!=c.config.bename&&a(c.config.bename).html(d+e);"function"==typeof c.config.hanziback&&c.config.hanziback(e);"function"==typeof c.config.numberback&&c.config.numberback(b)}else b=b.toLowerCase(),d+=b,10<d.length&&(d=d.substring(0,10)),d=d.firstUpperCase(),t.html(d),b=[],c.config.isZzj?b=JSON.parse(ChineseInput.PinyinTrance(d)):(d=PinYin[d],void 0!=d&&(b=d.split(""))),"function"==typeof c.config.charback&&c.config.charback(b),q(".spell-container",
b)});a(".spell-container .keys-box li[remove]").on("click",function(){a.TheKeySound();if(1==c.config.type){var b=a(c).val(),d=b.substring(0,b.length-1);a(c).val(d);void 0!=c.config.bename&&a(c.config.bename).html(d);"function"==typeof c.config.delback&&c.config.delback(d)}else b=t.text(),b=b.substring(0,b.length-1),t.html(b),d=[],c.config.isZzj?d=JSON.parse(ChineseInput.PinyinTrance(b)):(b=PinYin[b],void 0!=b&&(d=b.split(""))),"function"==typeof c.config.delback&&c.config.delback(d),q(".spell-container",
d)});String.prototype.firstUpperCase=function(){return this.replace(/^\S/,function(a){return a.toUpperCase()})}}})})(jQuery);